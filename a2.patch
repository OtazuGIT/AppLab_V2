diff --git a/main_window.py b/main_window.py
index 3dea5e1d1a2480c2397459a7902b1079aea75c8c..125b4fe8a83c87f51c185ad29977057256fc38d7 100644
--- a/main_window.py
+++ b/main_window.py
@@ -1,36 +1,36 @@
 # main_window.py
 import copy
 import datetime
 import inspect
 import json
 import os
 import re
 import unicodedata
 from collections import OrderedDict
 from PyQt5.QtWidgets import (QMainWindow, QWidget, QLabel, QPushButton, QVBoxLayout, QHBoxLayout,
-                             QStackedWidget, QFormLayout, QScrollArea, QGroupBox, QComboBox,
+                             QStackedWidget, QTabWidget, QFormLayout, QScrollArea, QGroupBox, QComboBox,
                              QLineEdit, QTextEdit, QTableWidget, QTableWidgetItem, QFileDialog, QMessageBox, QCheckBox,
                              QDateEdit, QRadioButton, QButtonGroup, QDialog, QDialogButtonBox, QListWidget, QListWidgetItem,
                              QSpinBox, QInputDialog, QAbstractItemView, QGridLayout)
 from PyQt5.QtCore import QDate, QDateTime, Qt, QTimer
 from PyQt5.QtGui import QColor, QFont
 from fpdf import FPDF  # Asegúrese de tener fpdf instalado (pip install fpdf)
 
 LAB_TITLE = "Laboratorio P.S. Iñapari - 002789"
 
 MONTH_NAMES_ES = [
     "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
     "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
 ]
 
 CATEGORY_DISPLAY_ORDER = [
     "HEMATOLOGÍA",
     "BIOQUÍMICA",
     "INMUNOLOGÍA",
     "PRUEBAS RÁPIDAS",
     "PARASITOLOGÍA",
     "MICROBIOLOGÍA",
     "MICROSCOPÍA",
     "LABORATORIO REFERENCIAL",
     "OTROS",
     "TOMA DE MUESTRA"
@@ -3653,50 +3653,51 @@ class MainWindow(QMainWindow):
             if test_name:
                 parts.append(f"{test_name}: {text}")
             else:
                 parts.append(text)
         return "\n".join(parts) if parts else "-"
 
     def _format_history_gestation(self, entry):
         display = self._format_registry_pregnancy_line(entry)
         return display if display else "-"
 
     def _build_history_row_values(self, entry):
         return [
             self._format_date_for_registry(entry),
             str(entry.get("order_id", "-")),
             entry.get("patient", "-"),
             entry.get("document", "-"),
             self._format_birth_for_history(entry.get("birth_date")),
             entry.get("age", "-"),
             self._format_history_gestation(entry),
             self._format_sex_display(entry.get("sex")),
             entry.get("origin", "-") or "-",
             entry.get("hcl", "-") or "-",
             self._format_insurance_display(entry.get("insurance_type")),
             self._format_fua_display(entry),
             self._format_history_sample_status(entry),
+            "\n".join(sorted(entry.get("tests", []))) or "-",
             "\n  ".join(entry.get("groups", {}).get("hematology", [])) or "-",
             "\n  ".join(entry.get("groups", {}).get("biochemistry", [])) or "-",
             "\n  ".join(entry.get("groups", {}).get("micro_parasito", [])) or "-",
             "\n  ".join(entry.get("groups", {}).get("others", [])) or "-",
             self._format_emission_status(entry.get("emitted"), entry.get("emitted_at"))
         ]
 
     def _populate_history_table_widget(self, table_widget, aggregated):
         headers = getattr(self, 'history_headers', [])
         if not headers or not isinstance(aggregated, list):
             return
         table_widget.setRowCount(len(aggregated))
         for row_idx, entry in enumerate(aggregated):
             values = self._build_history_row_values(entry)
             for col_idx, value in enumerate(values):
                 item = QTableWidgetItem(str(value))
                 if headers[col_idx] in {"Orden", "Edad", "F. Nacimiento", "Sexo", "Tipo de seguro", "FUA", "Gestación"}:
                     item.setTextAlignment(Qt.AlignCenter)
                 table_widget.setItem(row_idx, col_idx, item)
     def _calculate_age_years(self, patient_info, order_info):
         age_value = order_info.get('age_years') if isinstance(order_info, dict) else None
         if age_value is not None:
             try:
                 return int(age_value)
             except (TypeError, ValueError):
@@ -4679,207 +4680,233 @@ class MainWindow(QMainWindow):
             WHERE (o.deleted IS NULL OR o.deleted=0) AND (ot.deleted IS NULL OR ot.deleted=0)
         """)
         rows = self.labdb.cur.fetchall()
         try:
             with open(file_path, 'w', encoding='utf-8') as f:
                 f.write("Nombre,Apellidos,Documento,Prueba,Resultado,Fecha,Solicitante,Estado de muestra,Observación muestra,Edad (años)\n")
                 for first, last, doc_type, doc_num, sex, birth_date, test_name, result, date, requester, sample_status, sample_issue, observation, age_years in rows:
                     name = (first or "").upper(); surn = (last or "").upper(); doc = f"{doc_type} {doc_num}".strip()
                     context = {
                         "patient": {"sex": sex, "birth_date": birth_date},
                         "order": {"age_years": age_years}
                     }
                     res = self._format_result_for_export(test_name, result, context=context)
                     res = res.replace('"', "'")
                     dt = date
                     req = (requester or "").upper()
                     status_text = self._format_sample_status_text(sample_status, sample_issue) or "-"
                     obs_text = (observation or "").strip().replace('"', "'")
                     age_txt = str(age_years) if age_years is not None else ""
                     line = f"{name},{surn},{doc},{test_name},\"{res}\",{dt},{req},{status_text},\"{obs_text}\",{age_txt}\n"
                     f.write(line)
             QMessageBox.information(self, "Exportado", f"Datos exportados a:\n{file_path}")
         except Exception as e:
             QMessageBox.warning(self, "Error", f"No se pudo exportar:\n{e}")
     def init_analisis_page(self):
-        layout = QVBoxLayout(self.page_analisis)
+        main_layout = QVBoxLayout(self.page_analisis)
+        self.analysis_tabs = QTabWidget()
+        main_layout.addWidget(self.analysis_tabs)
+
+        stats_tab = QWidget()
+        stats_layout = QVBoxLayout(stats_tab)
         stats_controls_layout = QHBoxLayout()
         stats_controls_layout.addWidget(QLabel("Visualizar por:"))
         self.stats_mode_combo = QComboBox()
         self.stats_mode_combo.addItems(["Mes", "Trimestre"])
         stats_controls_layout.addWidget(self.stats_mode_combo)
         today = datetime.date.today()
         self.stats_month_label = QLabel("Mes:")
         stats_controls_layout.addWidget(self.stats_month_label)
         self.stats_month_combo = QComboBox()
         self.stats_month_combo.addItems(MONTH_NAMES_ES)
         self.stats_month_combo.setCurrentIndex(max(0, today.month - 1))
         stats_controls_layout.addWidget(self.stats_month_combo)
         self.stats_quarter_label = QLabel("Trimestre:")
         stats_controls_layout.addWidget(self.stats_quarter_label)
         self.stats_quarter_combo = QComboBox()
         self.stats_quarter_combo.addItems(["I", "II", "III", "IV"])
         self.stats_quarter_combo.setCurrentIndex((today.month - 1) // 3)
         stats_controls_layout.addWidget(self.stats_quarter_combo)
         stats_controls_layout.addWidget(QLabel("Año:"))
         self.stats_year_spin = QSpinBox()
         self.stats_year_spin.setRange(2000, 2100)
         self.stats_year_spin.setValue(today.year)
         stats_controls_layout.addWidget(self.stats_year_spin)
         stats_controls_layout.addStretch()
-        layout.addLayout(stats_controls_layout)
+        stats_layout.addLayout(stats_controls_layout)
         self.stats_label = QLabel()
         self.stats_label.setStyleSheet("font-weight: bold;")
-        layout.addWidget(self.stats_label)
+        stats_layout.addWidget(self.stats_label)
         self.stats_table = QTableWidget(0, 3)
         self.stats_table.setHorizontalHeaderLabels(["Área", "Examen", "Cantidad"])
         self.stats_table.setAlternatingRowColors(True)
         self.stats_table.setEditTriggers(QAbstractItemView.NoEditTriggers)
         self.stats_table.setSelectionMode(QAbstractItemView.NoSelection)
         self.stats_table.verticalHeader().setVisible(False)
         self.stats_table.horizontalHeader().setStretchLastSection(True)
-        layout.addWidget(self.stats_table)
+        stats_layout.addWidget(self.stats_table)
+        self.analysis_tabs.addTab(stats_tab, "Estadísticas")
+
+        activity_tab = QWidget()
+        activity_layout = QVBoxLayout(activity_tab)
         controls_layout = QHBoxLayout()
         controls_layout.addWidget(QLabel("Período:"))
         self.range_combo = QComboBox()
         self.range_combo.addItems([
             "Hoy",
             "Esta semana",
             "Este mes",
             "Últimos 30 días",
             "Rango personalizado"
         ])
         controls_layout.addWidget(self.range_combo)
         controls_layout.addSpacing(10)
         self.start_date_edit = QDateEdit(QDate.currentDate())
         self.start_date_edit.setDisplayFormat("dd/MM/yyyy")
         self.start_date_edit.setCalendarPopup(True)
         controls_layout.addWidget(QLabel("Desde:"))
         controls_layout.addWidget(self.start_date_edit)
         self.end_date_edit = QDateEdit(QDate.currentDate())
         self.end_date_edit.setDisplayFormat("dd/MM/yyyy")
         self.end_date_edit.setCalendarPopup(True)
         controls_layout.addWidget(QLabel("Hasta:"))
         controls_layout.addWidget(self.end_date_edit)
         controls_layout.addSpacing(10)
         self.view_activity_btn = QPushButton("Mostrar registro")
         self.export_activity_pdf_btn = QPushButton("Exportar PDF")
         self.export_activity_csv_btn = QPushButton("Exportar CSV")
         self.export_activity_delivery_btn = QPushButton("Hoja de entrega")
         self.delete_activity_btn = QPushButton("Eliminar selección")
         self.delete_activity_btn.setStyleSheet(
             "QPushButton { background-color: #ffe8e6; color: #c0392b; border-radius: 10px; border: 1px solid #c0392b; }"
             "QPushButton:hover:!disabled { background-color: #fbd1ce; }"
         )
         controls_layout.addWidget(self.view_activity_btn)
         controls_layout.addWidget(self.export_activity_pdf_btn)
         controls_layout.addWidget(self.export_activity_csv_btn)
         controls_layout.addWidget(self.export_activity_delivery_btn)
         controls_layout.addWidget(self.delete_activity_btn)
         controls_layout.addStretch()
-        layout.addLayout(controls_layout)
+        activity_layout.addLayout(controls_layout)
+
+        activity_filter_layout = QHBoxLayout()
+        activity_filter_layout.addWidget(QLabel("Búsqueda por muestras:"))
+        self.activity_search_input = QLineEdit()
+        self.activity_search_input.setPlaceholderText("Filtrar por prueba, paciente o estado de muestra")
+        self.activity_search_input.setClearButtonEnabled(True)
+        activity_filter_layout.addWidget(self.activity_search_input)
+        activity_filter_layout.addStretch()
+        activity_layout.addLayout(activity_filter_layout)
+
         self.activity_caption = QLabel()
         self.activity_caption.setStyleSheet("font-weight: bold;")
-        layout.addWidget(self.activity_caption)
+        activity_layout.addWidget(self.activity_caption)
         self.activity_table = QTableWidget(0, 8)
         self.activity_table.setHorizontalHeaderLabels([
             "F. muestra / Registro",
             "Orden",
             "Paciente",
             "Documento",
             "Edad",
             "Prueba",
             "Estado",
             "Resultado"
         ])
         self.activity_table.setAlternatingRowColors(True)
         self.activity_table.horizontalHeader().setStretchLastSection(True)
         self.activity_table.setSelectionMode(QTableWidget.MultiSelection)
-        layout.addWidget(self.activity_table)
+        activity_layout.addWidget(self.activity_table)
+        self.analysis_tabs.addTab(activity_tab, "Registro de pruebas")
+
+        history_tab = QWidget()
+        history_tab_layout = QVBoxLayout(history_tab)
         history_group = QGroupBox("Historial de pacientes")
         history_layout = QVBoxLayout(history_group)
         history_search_layout = QHBoxLayout()
         history_search_layout.addWidget(QLabel("DNI:"))
         self.history_doc_input = QLineEdit()
         self.history_doc_input.setPlaceholderText("Ingrese DNI")
         history_search_layout.addWidget(self.history_doc_input)
         history_search_layout.addWidget(QLabel("Apellidos:"))
         self.history_lastname_input = QLineEdit()
         self.history_lastname_input.setPlaceholderText("Ej. PEREZ / PEREZ GARCIA")
         history_search_layout.addWidget(self.history_lastname_input)
         self.history_search_btn = QPushButton("Buscar")
         history_search_layout.addWidget(self.history_search_btn)
         self.history_open_btn = QPushButton("Ver en emisión")
         self.history_open_btn.setEnabled(False)
         history_search_layout.addWidget(self.history_open_btn)
         self.history_fua_btn = QPushButton("Registrar FUA")
         self.history_fua_btn.setEnabled(False)
         history_search_layout.addWidget(self.history_fua_btn)
         self.history_window_btn = QPushButton("Ventana de historial")
         self.history_window_btn.setEnabled(False)
         history_search_layout.addWidget(self.history_window_btn)
         history_search_layout.addStretch()
         history_layout.addLayout(history_search_layout)
         history_headers = [
             "F. muestra / Registro",
             "Orden",
             "Paciente",
             "Documento",
             "F. Nacimiento",
             "Edad",
             "Gestación",
             "Sexo",
             "Procedencia",
             "HCL",
             "Tipo de seguro",
             "FUA",
             "Seguimiento",
+            "Exámenes de la orden",
             "Hematología",
             "Bioquímica",
             "Micro/Parasitología",
             "Otros exámenes",
             "Emitido"
         ]
         self.history_table = QTableWidget(0, len(history_headers))
         self.history_table.setHorizontalHeaderLabels(history_headers)
         self.history_table.setSelectionBehavior(QTableWidget.SelectRows)
         self.history_table.setSelectionMode(QTableWidget.SingleSelection)
         self.history_table.setAlternatingRowColors(True)
         self.history_table.setWordWrap(True)
         self.history_table.verticalHeader().setVisible(False)
         self.history_table.horizontalHeader().setStretchLastSection(True)
         self.history_headers = history_headers
         self.history_column_map = {header: idx for idx, header in enumerate(history_headers)}
         history_layout.addWidget(self.history_table)
-        layout.addWidget(history_group)
+        history_tab_layout.addWidget(history_group)
+        self.analysis_tabs.addTab(history_tab, "Historial de pacientes")
         self._stats_controls_ready = False
         self.stats_mode_combo.currentIndexChanged.connect(self._update_stats_period_controls)
         self.stats_month_combo.currentIndexChanged.connect(lambda _: self.refresh_statistics())
         self.stats_quarter_combo.currentIndexChanged.connect(lambda _: self.refresh_statistics())
         self.stats_year_spin.valueChanged.connect(lambda _: self.refresh_statistics())
         self._history_results = []
         self.range_combo.currentIndexChanged.connect(self._update_range_controls)
+        self.activity_search_input.textChanged.connect(self.apply_activity_filter)
         self.view_activity_btn.clicked.connect(self.load_activity_summary)
         self.export_activity_pdf_btn.clicked.connect(lambda: self.export_activity_record("pdf"))
         self.export_activity_csv_btn.clicked.connect(lambda: self.export_activity_record("csv"))
         self.export_activity_delivery_btn.clicked.connect(self.export_activity_delivery_sheet)
         self.delete_activity_btn.clicked.connect(self.delete_selected_activity_entries)
         self._update_range_controls()
         self._stats_controls_ready = True
         self._update_stats_period_controls()
         self.history_doc_input.returnPressed.connect(self.search_patient_history)
         self.history_lastname_input.returnPressed.connect(self.search_patient_history)
         self.history_search_btn.clicked.connect(self.search_patient_history)
         self.history_open_btn.clicked.connect(self.open_history_order_from_analysis)
         self.history_table.itemSelectionChanged.connect(self._on_history_selection_changed)
         self.history_fua_btn.clicked.connect(self.edit_history_fua)
         self.history_window_btn.clicked.connect(self.open_history_window)
     def refresh_statistics(self):
         if not getattr(self, '_stats_controls_ready', False):
             return
         period = self._get_statistics_period()
         start_dt = datetime.datetime.combine(period['start'], datetime.time(0, 0, 0))
         end_dt = datetime.datetime.combine(period['end'], datetime.time(23, 59, 59))
         stats = self.labdb.get_statistics(start_dt.isoformat(sep=' '), end_dt.isoformat(sep=' '))
         summary_lines = [
             f"Período: {period['label']}",
             f"Pacientes atendidos: {stats['total_patients']}",
@@ -4996,50 +5023,103 @@ class MainWindow(QMainWindow):
                 next_month = datetime.date(start_date.year + 1, 1, 1)
             else:
                 next_month = datetime.date(start_date.year, start_date.month + 1, 1)
             end_date = next_month - datetime.timedelta(days=1)
             description = f"Mes del {start_date.strftime('%d/%m/%Y')} al {end_date.strftime('%d/%m/%Y')}"
         elif idx == 3:  # Últimos 30 días
             start_date = today - datetime.timedelta(days=29)
             end_date = today
             description = f"Últimos 30 días ({start_date.strftime('%d/%m/%Y')} al {end_date.strftime('%d/%m/%Y')})"
         else:  # Rango personalizado
             if hasattr(self, 'start_date_edit') and hasattr(self, 'end_date_edit'):
                 start_q = self.start_date_edit.date()
                 end_q = self.end_date_edit.date()
                 if start_q.isValid():
                     start_date = datetime.date(start_q.year(), start_q.month(), start_q.day())
                 if end_q.isValid():
                     end_date = datetime.date(end_q.year(), end_q.month(), end_q.day())
             if end_date < start_date:
                 start_date, end_date = end_date, start_date
             description = f"Del {start_date.strftime('%d/%m/%Y')} al {end_date.strftime('%d/%m/%Y')}"
         start_dt = datetime.datetime.combine(start_date, datetime.time.min)
         end_dt = datetime.datetime.combine(end_date, datetime.time.max)
         return start_dt, end_dt, description
 
 
+    def _render_activity_rows(self, activity_data, description, total_count=None):
+        if not hasattr(self, 'activity_table'):
+            return
+        self.activity_table.setRowCount(len(activity_data))
+        for row_idx, item in enumerate(activity_data):
+            self.activity_table.setItem(row_idx, 0, QTableWidgetItem(item.get("date", "")))
+            order_item = QTableWidgetItem(str(item.get("order_id", "")))
+            order_item.setTextAlignment(Qt.AlignCenter)
+            self.activity_table.setItem(row_idx, 1, order_item)
+            self.activity_table.setItem(row_idx, 2, QTableWidgetItem(item.get("patient", "")))
+            self.activity_table.setItem(row_idx, 3, QTableWidgetItem(item.get("document", "")))
+            age_item = QTableWidgetItem(item.get("age", ""))
+            age_item.setTextAlignment(Qt.AlignCenter)
+            self.activity_table.setItem(row_idx, 4, age_item)
+            self.activity_table.setItem(row_idx, 5, QTableWidgetItem(item.get("test", "")))
+            status_text = self._format_sample_status_text(item.get("sample_status"), item.get("sample_issue"))
+            self.activity_table.setItem(row_idx, 6, QTableWidgetItem(status_text or "-"))
+            self.activity_table.setItem(row_idx, 7, QTableWidgetItem(item.get("result", "")))
+        if hasattr(self, 'activity_caption'):
+            query = self.activity_search_input.text().strip() if hasattr(self, 'activity_search_input') else ""
+            filtered_count = len(activity_data)
+            base_total = total_count if total_count is not None else filtered_count
+            if query and base_total != filtered_count:
+                count_text = f"{filtered_count} coincidencia(s) de {base_total}" + (f" (filtro: \"{query}\")" if query else "")
+            else:
+                count_text = f"{filtered_count} resultado(s)"
+            self.activity_caption.setText(
+                f"Registro de pruebas: {description} - {count_text}"
+            )
+
+
+    def apply_activity_filter(self):
+        cache = getattr(self, '_activity_cache', {}) if hasattr(self, '_activity_cache') else {}
+        data = cache.get("data", [])
+        description = cache.get("description", "")
+        query = self.activity_search_input.text().strip().lower() if hasattr(self, 'activity_search_input') else ""
+        if not query:
+            filtered = data
+        else:
+            def matches(item):
+                haystacks = [
+                    item.get("patient", ""),
+                    item.get("document", ""),
+                    item.get("test", ""),
+                    self._format_sample_status_text(item.get("sample_status"), item.get("sample_issue")) or "",
+                    item.get("result", ""),
+                ]
+                haystacks = [h for h in haystacks if h not in (None, "")]
+                return any(query in str(value).lower() for value in haystacks)
+            filtered = [item for item in data if matches(item)]
+        self._render_activity_rows(filtered, description, total_count=len(data))
+
+
     def load_activity_summary(self):
         if not hasattr(self, 'activity_table'):
             return
         start_dt, end_dt, description = self._get_selected_range()
         rows = self.labdb.get_results_in_range(
             start_dt.strftime("%Y-%m-%d %H:%M:%S"),
             end_dt.strftime("%Y-%m-%d %H:%M:%S")
         )
         activity_data = []
         for (
             test_entry_id,
             order_id,
             date_str,
             sample_date_str,
             first,
             last,
             doc_type,
             doc_number,
             sex,
             birth_date,
             hcl,
             origin,
             is_pregnant,
             gest_age_weeks,
             expected_delivery,
@@ -5085,69 +5165,54 @@ class MainWindow(QMainWindow):
                 "is_pregnant": is_pregnant,
                 "gestational_age_weeks": gest_age_weeks,
                 "expected_delivery_date": expected_delivery,
                 "age": age_display,
                 "test": test_name,
                 "result": result_text,
                 "summary_items": summary_items,
                 "category": category,
                 "order_observations": order_obs,
                 "insurance_type": insurance_type,
                 "fua_number": fua_number,
                 "emitted": None,
                 "emitted_at": None,
                 "first_name": first,
                 "last_name": last,
                 "sample_status": sample_status,
                 "sample_issue": sample_issue,
                 "observation": observation
             })
         self._activity_cache = {
             "data": activity_data,
             "description": description,
             "start": start_dt,
             "end": end_dt
         }
-        self.activity_table.setRowCount(len(activity_data))
-        for row_idx, item in enumerate(activity_data):
-            self.activity_table.setItem(row_idx, 0, QTableWidgetItem(item["date"]))
-            order_item = QTableWidgetItem(str(item["order_id"]))
-            order_item.setTextAlignment(Qt.AlignCenter)
-            self.activity_table.setItem(row_idx, 1, order_item)
-            self.activity_table.setItem(row_idx, 2, QTableWidgetItem(item["patient"]))
-            self.activity_table.setItem(row_idx, 3, QTableWidgetItem(item["document"]))
-            age_item = QTableWidgetItem(item["age"])
-            age_item.setTextAlignment(Qt.AlignCenter)
-            self.activity_table.setItem(row_idx, 4, age_item)
-            self.activity_table.setItem(row_idx, 5, QTableWidgetItem(item["test"]))
-            status_text = self._format_sample_status_text(item.get("sample_status"), item.get("sample_issue"))
-            self.activity_table.setItem(row_idx, 6, QTableWidgetItem(status_text or "-"))
-            self.activity_table.setItem(row_idx, 7, QTableWidgetItem(item["result"]))
-        if hasattr(self, 'activity_caption'):
-            self.activity_caption.setText(
-                f"Registro de pruebas: {description} - {len(activity_data)} resultado(s)"
-            )
+        if hasattr(self, 'activity_search_input'):
+            self.apply_activity_filter()
+        else:
+            self._render_activity_rows(activity_data, description)
 
 
     def delete_selected_activity_entries(self):
         if not hasattr(self, 'activity_table'):
             return
         selected = self.activity_table.selectionModel().selectedRows() if self.activity_table.selectionModel() else []
         if not selected:
             QMessageBox.information(self, "Sin selección", "Seleccione al menos un resultado para eliminar.")
             return
         if not getattr(self, '_activity_cache', None):
             self.load_activity_summary()
         cache = getattr(self, '_activity_cache', {"data": []})
         entries = cache.get("data", [])
         selected_ids = []
         for model_index in selected:
             row = model_index.row()
             if 0 <= row < len(entries):
                 entry = entries[row]
                 entry_id = entry.get("entry_id")
                 if entry_id:
                     selected_ids.append(entry_id)
         if not selected_ids:
             QMessageBox.warning(self, "Sin datos", "No se pudo identificar los registros seleccionados.")
             return
         dialog = ReasonDialog(
